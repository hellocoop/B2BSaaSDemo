(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();var b=Object.create,y=Object.defineProperty,N=Object.getOwnPropertyDescriptor,I=Object.getOwnPropertyNames,C=Object.getPrototypeOf,R=Object.prototype.hasOwnProperty,U=(e,t)=>function(){return t||(0,e[I(e)[0]])((t={exports:{}}).exports,t),t.exports},V=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of I(t))!R.call(e,o)&&o!==n&&y(e,o,{get:()=>t[o],enumerable:!(i=N(t,o))||i.enumerable});return e},M=(e,t,n)=>(n=e!=null?b(C(e)):{},V(!e||!e.__esModule?y(n,"default",{value:e,enumerable:!0}):n,e)),q=U({"../definitions/dist/index.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Button=e.NotLoggedIn=e.VALID_PROVIDER_HINT=e.VALID_RESPONSE_MODE=e.VALID_RESPONSE_TYPE=e.VALID_SCOPES=e.VALID_IDENTITY_CLAIMS=e.ORG_CLAIM=e.VALID_IDENTITY_ACCOUNT_CLAIMS=e.VALID_IDENTITY_STRING_CLAIMS=e.DEFAULT_PATH=e.DEFAULT_RESPONSE_MODE=e.DEFAULT_RESPONSE_TYPE=e.DEFAULT_SCOPE=e.PRODUCTION_WALLET=void 0,e.PRODUCTION_WALLET="https://wallet.hello.coop",e.DEFAULT_SCOPE=["openid","name","email","picture"],e.DEFAULT_RESPONSE_TYPE="code",e.DEFAULT_RESPONSE_MODE="query",e.DEFAULT_PATH="/authorize?",e.VALID_IDENTITY_STRING_CLAIMS=["name","nickname","preferred_username","given_name","family_name","email","phone","picture","ethereum"],e.VALID_IDENTITY_ACCOUNT_CLAIMS=["discord","twitter","github","gitlab"],e.ORG_CLAIM="org",e.VALID_IDENTITY_CLAIMS=[...e.VALID_IDENTITY_STRING_CLAIMS,...e.VALID_IDENTITY_ACCOUNT_CLAIMS,"org","email_verified","phone_verified"],e.VALID_SCOPES=[...e.VALID_IDENTITY_STRING_CLAIMS,...e.VALID_IDENTITY_ACCOUNT_CLAIMS,"profile","openid","profile_update"],e.VALID_RESPONSE_TYPE=["id_token","code"],e.VALID_RESPONSE_MODE=["fragment","query","form_post"],e.VALID_PROVIDER_HINT=["apple","discord","facebook","github","gitlab","google","twitch","twitter","tumblr","mastodon","microsoft","line","wordpress","yahoo","phone","ethereum","qrcode","apple--","microsoft--"],e.NotLoggedIn={isLoggedIn:!1};var t;(function(n){n.STYLES_URL="https://cdn.hello.coop/css/hello-btn.css",n.HOVER_MAPPING={pop:"",glow:"hello-btn-hover-glow",flare:"hello-btn-hover-flare",none:"hello-btn-hover-none"},n.CLASS_MAPPING={black:{"ignore-light":"","ignore-dark":"hello-btn-black-on-dark","aware-invert":"hello-btn-black-and-invert","aware-static":"hello-btn-black-and-static"},white:{"ignore-light":"hello-btn-white-on-light","ignore-dark":"hello-btn-white-on-dark","aware-invert":"hello-btn-white-and-invert","aware-static":"hello-btn-white-and-static"}}})(t||(e.Button=t={}))}});function k(e){return crypto.getRandomValues(new Uint8Array(e))}function F(e){const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~";let n="";const i=k(e);for(let o=0;o<e;o++){const r=i[o]%t.length;n+=t[r]}return n}function Y(e){return F(e)}async function j(e){const t=await crypto.subtle.digest("SHA-256",new TextEncoder().encode(e));return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")}async function G(e){if(e||(e=43),e<43||e>128)throw`Expected a length between 43 and 128. Received ${e}.`;const t=Y(e),n=await j(t);return{code_verifier:t,code_challenge:n}}var a=M(q());function H(e){return a.VALID_SCOPES.includes(e)}function B(e){return e.every(t=>H(t))}async function J(e){if(!e.client_id)throw new Error("client_id is required in the authorization request.");if(!e.redirect_uri)throw new Error("redirect_uri is required in the authorization request.");if(e.scope){if(!B(e.scope))throw new Error("One or more passed scopes are invalid.");e.scope=Array.from(new Set([...e.scope,"openid"]))}if(e.response_type&&!a.VALID_RESPONSE_TYPE.includes(e.response_type))throw new Error("Invalid response_type.");if(e.response_mode&&!a.VALID_RESPONSE_MODE.includes(e.response_mode))throw new Error("Invalid response_mode.");const t=e.nonce||crypto.randomUUID();let n="";const o=(e.scope||a.DEFAULT_SCOPE).join(" "),r={client_id:e.client_id,redirect_uri:e.redirect_uri,scope:o,response_type:e.response_type||a.DEFAULT_RESPONSE_TYPE,response_mode:e.response_mode||a.DEFAULT_RESPONSE_MODE,nonce:t};if(e.prompt&&(r.prompt=e.prompt),r.response_type==="code"){const s=await G();n=s.code_verifier,r.code_challenge=s.code_challenge,r.code_challenge_method="S256"}return e.provider_hint&&(r.provider_hint=e.provider_hint.join(" ")),e.login_hint&&(r.login_hint=e.login_hint),e.domain_hint&&(r.domain_hint=e.domain_hint),{url:(e.wallet||a.PRODUCTION_WALLET)+a.DEFAULT_PATH+new URLSearchParams(r).toString(),nonce:t,code_verifier:n}}var W="/oauth/token";async function $({code:e,code_verifier:t,client_id:n,redirect_uri:i,wallet:o}){const r={code:e,code_verifier:t,client_id:n,redirect_uri:i,grant_type:"authorization_code"},c=new URLSearchParams(r).toString(),s=(o||a.PRODUCTION_WALLET)+W;try{const d=await fetch(s,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c}),l=await d.json();if(!d.ok){const v=`Fetch ${s} failed with ${d.status}. `+(l.error?l.error+".":"");throw new Error(v)}if(l.error)throw new Error(l.error);if(!l.id_token)throw new Error("No id_token in response.");return l.id_token}catch(d){throw new Error(d)}}function E(e){var t=e.replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(window.atob(t).split("").map(function(i){return"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(n)}function z(e){try{const[t,n]=e.split("."),i=E(t),o=E(n);return{header:i,payload:o}}catch(t){throw new Error(t)}}a.DEFAULT_PATH;a.DEFAULT_RESPONSE_MODE;a.DEFAULT_RESPONSE_TYPE;a.DEFAULT_SCOPE;a.PRODUCTION_WALLET;a.VALID_RESPONSE_MODE;a.VALID_RESPONSE_TYPE;a.VALID_SCOPES;const u={client_id:"app_B2BSaaSDemonstrationAppX_HaQ",redirect_uri:"http://localhost:5173/",scope:["openid","profile"],response_mode:"fragment",domain_hint:"managed",wallet:"https://wallet.hello-dev.net/"},h=document.querySelector("#login-btn"),K=document.querySelector("#logout-btn"),f=document.querySelector("#invite-btn"),L=document.querySelector("#profile-page"),S=document.querySelector("#login-page"),T=document.querySelector("#profile-page-content"),O=document.querySelector("#modal-container"),Q=document.querySelector("#error-container"),m=document.querySelector("#error"),X=document.querySelector("#org-domain"),Z=document.querySelector("#org-id"),x=document.querySelector("#full-name"),ee=document.querySelector("#email"),g=document.querySelector("#picture"),te=document.querySelector("#load-spinner"),ne=document.querySelector("#org-container"),oe=document.querySelector("#close-modal-btn");window.addEventListener("load",re);h.addEventListener("click",P);K.addEventListener("click",ie);f.addEventListener("click",se);oe.addEventListener("click",ce);async function re(){const{search:e}=window.location,t=window.location.hash.substring(1),n=new URLSearchParams(e||t),i=n.has("iss"),o=n.has("code"),r=n.has("error"),c=JSON.parse(sessionStorage.getItem("profile"));if(i)return P(null,n);o?ae(n):r?A(n,c):c?w(c):_(),D(),le()}async function P(e,t){h.classList.add("hello-btn-loader"),h.disabled=!0;const{url:n,nonce:i,code_verifier:o}=await J({...u,login_hint:(t==null?void 0:t.get("login_hint"))||void 0,domain_hint:(t==null?void 0:t.get("domain_hint"))||u.domain_hint,wallet:"https://wallet.hello-dev.net/"});sessionStorage.setItem("nonce",i),sessionStorage.setItem("code_verifier",o),await p({u:"/start/login",n:"action"}),window.location.href=n}function ie(){p({u:"/logout",n:"action"}),sessionStorage.clear(),_()}async function ae(e){try{const t=await $({client_id:u.client_id,redirect_uri:u.redirect_uri,code_verifier:sessionStorage.getItem("code_verifier"),nonce:sessionStorage.getItem("nonce"),code:e.get("code"),wallet:"https://wallet.hello-dev.net/"}),{payload:n}=z(t);sessionStorage.clear(),sessionStorage.setItem("profile",JSON.stringify(n)),p({u:"/profile"}),w(n)}catch(t){console.error(t),sessionStorage.clear(),_(),A(e)}finally{D()}}function A(e,t){const n=e.get("error");O.style.display="flex",Q.style.display="block",n==="access_denied"?m.innerText="User cancelled request.":m.innerText="Something went wrong.",t?w(t):_()}function ce(){O.style.display="none"}function D(){window.location.hash&&(window.location.replace("#"),typeof window.history.replaceState=="function"&&history.replaceState({},"",window.location.href.slice(0,-1)))}function le(){te.style.display="none"}function _(){let e="/";window.location.search&&(e+=window.location.search),p({u:e}),S.style.visibility="visible",S.style.position="relative",L.style.display="none",T.style.display="none",document.body.style.backgroundImage="url(/assets/bg.jpg)"}async function p(e){if(localStorage.getItem("plausible_ignore")=="true"||window.location.origin!=="https://www.b2bsaasdemo.com"){console.info("Ignoring Event: localStorage flag");return}const t={w:window.innerWidth,d:"b2bsaasdemo.com",...e,n:e.n||"pageview",r:e.r||document.referrer||null,u:new URL(e.u,"https://www.b2bsaasdemo.com")};try{await fetch("/api/event",{method:"POST",body:JSON.stringify(t)}),console.info(`Event sent: ${t.u} (${t.n})`)}catch(n){console.error(n)}}function w(e){const{name:t,picture:n,email:i,org:o}=e;x.innerText=t,ee.innerText=i,g.src=n,g.style.backgroundImage=`url('${n}')`,o?(X.innerText=o==null?void 0:o.domain,Z.innerText=o==null?void 0:o.id):ne.style.display="none",L.style.display=T.style.display="block"}async function se(){f.classList.add("hello-btn-loader"),f.disabled=!0;const{sub:e}=JSON.parse(sessionStorage.getItem("profile")),t=new URL("https://wallet.hello-dev.net/invite");t.searchParams.append("inviter",e),t.searchParams.append("client_id",u.client_id),t.searchParams.append("initiate_login_uri",window.location.origin),t.searchParams.append("return_uri",window.location.origin),window.location.href=t.href}(function(){window.onpageshow=function(e){e.persisted&&window.location.reload()}})();
